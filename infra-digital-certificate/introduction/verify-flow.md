# 검증 절차

Cert 서비스를 활용하여 사용자(Holder)의 VP를 제출받고, 검증하기 위해서는 크게 아래 3가지 단계를 따릅니다.

1. VP 제출 요청 단계(VP Submit Request Step)
2. VP 제출 단계(VP Submit Step)
3. VP 검증 단계(After VP Submit Step)

Cert 서비스는 서비스 제공자의 상황과 환경에 맞추어 다양한 연결, 제출, 검증 방식을 제공합니다.

각각의 사례는 아래를 참조하여 상황에 맞는 서비스 흐름을 구현할 수 있습니다.

1. 연결 주체에 대한 사례

   1. 동일한 앱 사이에서 P2P 검증 시
      - 예를 들어 2개의 동일한 사용자 앱에서 검증하는 경우, 사용자나 검증자 중 한 앱에서 Dynamic QR을 생성하고 상대편 앱에서 카메라로 이를 스캔하여 Step 1을 진행합니다. (COOV 앱 간 상호 인증)
      - QR 생성은 양쪽이 가능합니다.
      - 검증자 앱에서 Cert 서버를 이용해 앱-서버 연결을 맺고 VP 제출 요청, VP 검증을 자동화할 수 있습니다.
   2. 동일/연계 서비스의 다른 앱 사이에서 P2P 검증 시
      - 예를 들어 비즈니스 서비스를 이용하는 매장과 사용자 앱을 사용하는 사용자 간에 Dynamic QR 생성, 스캔하여 Step 1을 진행합니다. (출입 명부 인증을 위해 매장 기기 카메라에 COOV 앱 QR 인증)
      - QR 생성은 양쪽이 가능합니다.
      - 검증자(매장 기기, 직원 등) 앱에서 Cert 서버를 이용해 앱-서버 연결을 맺고 VP 제출 요청, VP 검증을 자동화할 수 있습니다.
   3. 출력된 QR을 사용자 앱으로 스캔하여 검증 시
      - 예를 들어 가게 등록 등을 위해 미리 생성한 static QR을 출력하여 게시하고 사용자가 이를 스캔하여 Step 1을 진행합니다. (병원 접수, 매장 입장용 출력 QR 게시)
      - 사용자가 암호화 채널(WebSocket)을 연결하여 Cert 서버와 연결하여 검증, Cert 서버가 서비스 서버에게 콜백을 전달하는 방식입니다.
      - 서비스 제공자 상황에 맞게 WebSocket을 사용하지 않고 REST API를 이용하여 서버에 제출하는 방식으로 사용할 수 있습니다.
   4. 기타 원격 연결 시
      - 브라우저를 통해 사이트 인증(SSO)이나 서비스 연계 웹 사이트에서 사용자의 VP를 서버로 제출받는 경우입니다.
      - 서비스 서버 측에서 Cert 서버에 VP 검증 요청을 생성한 후 접근 API 등을 사용자에게 제공(QR, 푸쉬 등)하여 사용자가 서버를 통해 검증자를 인증하고 VP를 제출할 수 있습니다.
      - 서비스 제공자 상황에 맞게 Dynamic QR, Static QR, 기타 다양한 방식으로 사용자의 앱으로

2. 연결(제출) 방식에 대한 사례

   1. WebSocket Connection
      - 사용자(Holder)는 검증자(Verifier)의 요청에 따라 즉시 VP를 제출 / 거절할 수 있습니다.
      - 추후 제출(Submit Later)을 선택한 경우 이후에 REST API 방식으로 제출합니다.
   2. REST API
      - 사용자의 추후 제출이나 REST API 방식 연결에 의한 요청 시 사용자는 Cert 서버에 자신에게 요청된 VP 제출 요청과 요청한 검증자를 확인한 후 REST API를 이용하여 VP를 제출합니다.

3. 검증 방식에 대한 사례

   1. Verifier verify
      - 검증자가 직접 제출받은 VP에 대하여 SDK를 이용하여 클라이언트에서 VP를 검증할 수 있습니다.
      - 필요에 따라 Cert 서버에 검증 이력을 저장하여 나중에 조회, 검색할 수 있습니다.
   2. Cert Server verify
      - Cert Server로 VP 가 제출되거나 검증자가 요청하는 경우 Cert 서버에서 검증과 이력 저장을 수행하고 이를 반환합니다.
      - 검증용 앱의 경량화가 필요한 경우 사용할 수 있습니다.

종합적인 서비스 제공자의 상황에 따라 각 사례 별 필요한 케이스를 구현하실 수 있습니다.

예를 들어

1. 자체 서버 개발 자원이 부족하고 빠른 개발을 원할 경우, 대부분의 처리를 Cert 서버에 일임하는 방식(static QR 연결, REST API 제출, Cert server 검증)을 도입하면 사용자 앱 개발에 집중할 수 있습니다.
2. 검증 이력 등이 Cert 서버에 저장되길 원하지 않는 경우, Dynamic QR을 이용하여 앱 간 제출, 검증 흐름으로 서비스를 제공하여 직접 VP 제출, 검증할 수 있습니다.
3. 웹을 통해 제공되는 서비스가 있는 경우 REST API를 사용하여 사용자 앱과 Cert 서버가 검증 절차를 수행하고 웹 서비스 서버에게 콜백을 전달하는 형태로 개발할 수 있습니다.

- _각 케이스는 배타적이지 않습니다. 사용자의 선택 자유를 위해 모든 케이스를 한 서비스에서 지원할 수 있습니다._

좀 더 복잡한 사례나 적합한 케이스에 대한 도움이 필요하다면 [메일 문의](contact@bc-labs.net)를 통해 직접 문의하실 수 있습니다.

각각에 대한 흐름을 이해하기 위한 시퀀스 다이어그램을 확인하시기를 바랍니다.
